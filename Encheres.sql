-- Enchères
set autocommit off ;

-- 1. Proposition d'une offre de prix sur un produit disponible à la vente
INSERT INTO OFFRE VALUES ( TIMESTAMP '2020-09-13 09:01:00', 4, 30, 5, 0);
UPDATE PRODUIT SET PRIXCOURANT = 30 WHERE IDPRODUIT = 4;
commit;

-- 2. Si l'offre est la 5ème, alors le produit n'est plus à l'achat
INSERT INTO OFFRE VALUES ( TIMESTAMP '2020-09-13 09:02:00', 4, 35, 6, 0);
UPDATE PRODUIT SET PRIXCOURANT = 35 WHERE IDPRODUIT = 4;
commit;
INSERT INTO OFFRE VALUES ( TIMESTAMP '2020-09-13 09:03:00', 4,40, 5, 0);
UPDATE PRODUIT SET PRIXCOURANT = 40 WHERE IDPRODUIT = 4;
commit;
INSERT INTO OFFRE VALUES ( TIMESTAMP '2020-09-13 09:04:00', 4, 45, 6, 0);
UPDATE PRODUIT SET PRIXCOURANT = 45 WHERE IDPRODUIT = 4;
commit;
INSERT INTO OFFRE VALUES ( TIMESTAMP '2020-09-13 09:05:00', 4, 60, 5, 1); -- L'attribut ACHATREUSSI passe à 1 car l'offre est validée
UPDATE PRODUIT SET PRIXCOURANT = 60 WHERE IDPRODUIT = 4;
commit;

-- Compte le nombre d'offres sur un produit
SELECT COUNT(OFFRE.PRIXPROPOSE)
FROM OFFRE
WHERE OFFRE.IDPRODUIT = 1;
